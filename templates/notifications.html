{% extends 'base.html' %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
    <!-- Left Column: Form -->
    <div class="lg:col-span-2 space-y-6">
        <div class="bg-gray-800 rounded-2xl p-6 border border-gray-700 shadow-lg">
            <h2 class="text-xl font-bold text-white mb-2">Enviar notificação push</h2>
            <p class="text-sm text-gray-400 mb-6">Defina conteúdo, segmentação e agendamento.</p>

            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <!-- Template -->
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Template</label>
                    <select class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors appearance-none">
                        <option value="">Nenhum template selecionado</option>
                        <option value="promo">Promoção Relâmpago</option>
                        <option value="maintenance">Manutenção</option>
                    </select>
                </div>

                <!-- Title -->
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Título</label>
                    <input type="text" name="title" placeholder="Ex: Promoção relâmpago" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors">
                </div>

                <!-- Message -->
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Mensagem</label>
                    <textarea name="body" rows="4" placeholder="Conteúdo da sua notificação" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors resize-none"></textarea>
                </div>

                <!-- Type & Image -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Tipo</label>
                        <select name="type" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors appearance-none">
                            <option value="info">Informativo</option>
                            <option value="promo">Promocional</option>
                            <option value="warning">Aviso</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Imagem (Opcional)</label>
                        <input type="url" name="image_url" placeholder="https://..." class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors">
                    </div>
                </div>

                <!-- Schedule -->
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Agendar envio</label>
                    <input type="datetime-local" name="scheduled_at" class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-blue-500 transition-colors placeholder-gray-500">
                </div>

                <!-- Segmentation -->
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Segmentação</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <button type="button" data-segment="all" class="segment-btn flex flex-col items-center justify-center p-4 rounded-lg border-2 border-blue-500 bg-blue-500/10 text-white transition-all">
                            <span class="font-bold text-sm">Todos os usuários</span>
                            <span class="text-xs text-blue-200 mt-1">Envia para todos os tokens ativos</span>
                        </button>
                        <button type="button" data-segment="active" class="segment-btn flex flex-col items-center justify-center p-4 rounded-lg border border-gray-700 bg-gray-900 text-gray-400 hover:border-gray-600 transition-all">
                            <span class="font-bold text-sm">Somente ativos</span>
                            <span class="text-xs text-gray-500 mt-1">Usuários com status ativo</span>
                        </button>
                        <button type="button" data-segment="inactive" class="segment-btn flex flex-col items-center justify-center p-4 rounded-lg border border-gray-700 bg-gray-900 text-gray-400 hover:border-gray-600 transition-all">
                            <span class="font-bold text-sm">Somente inativos</span>
                            <span class="text-xs text-gray-500 mt-1">Reengaje usuários inativos</span>
                        </button>
                        <button type="button" data-segment="tags" class="segment-btn flex flex-col items-center justify-center p-4 rounded-lg border border-gray-700 bg-gray-900 text-gray-400 hover:border-gray-600 transition-all">
                            <span class="font-bold text-sm">Por tags</span>
                            <span class="text-xs text-gray-500 mt-1">Informe tags separadas por vírgula</span>
                        </button>
                    </div>
                    <button type="button" id="segment-search-btn" class="w-full p-4 rounded-lg border border-gray-700 bg-gray-900 text-gray-400 hover:border-gray-600 transition-all flex items-center justify-center">
                        <span class="font-bold text-sm">Busca</span>
                        <span class="text-xs text-gray-500 ml-2">Filtra por nome, email ou CPF</span>
                    </button>
                    <input type="hidden" name="segment_type" id="segment-type-input" value="all">
                    <input type="hidden" name="segment_tags" id="segment-tags-input">
                    <input type="hidden" name="segment_search" id="segment-search-input">
                </div>

                <!-- Submit -->
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg transition-colors shadow-lg shadow-blue-600/20">
                    Enviar notificação
                </button>
            </form>
        </div>
    </div>

    <!-- Right Column: Preview & Tips -->
    <div class="space-y-6">
        <!-- Preview -->
        <div class="bg-gray-800 rounded-2xl p-6 border border-gray-700 shadow-lg flex flex-col items-center">
            <h3 class="text-sm font-bold text-gray-400 uppercase mb-4 w-full">Pré-visualização</h3>
            
            <!-- Phone Mockup -->
            <div class="relative border-gray-900 bg-gray-900 border-[14px] rounded-[2.5rem] h-[550px] w-[280px] shadow-2xl flex-shrink-0">
                <div class="w-[120px] h-[18px] bg-gray-900 top-0 rounded-b-[1rem] left-1/2 -translate-x-1/2 absolute z-20"></div>
                <div class="h-[32px] w-[3px] bg-gray-800 absolute -left-[17px] top-[72px] rounded-l-lg"></div>
                <div class="h-[46px] w-[3px] bg-gray-800 absolute -left-[17px] top-[124px] rounded-l-lg"></div>
                <div class="h-[46px] w-[3px] bg-gray-800 absolute -left-[17px] top-[178px] rounded-l-lg"></div>
                <div class="h-[64px] w-[3px] bg-gray-800 absolute -right-[17px] top-[142px] rounded-r-lg"></div>
                
                <!-- Screen -->
                <div class="rounded-[2rem] overflow-hidden w-full h-full bg-gray-800 relative">
                    <!-- Wallpaper -->
                    <div class="absolute inset-0 bg-gradient-to-b from-blue-900 to-black opacity-80"></div>
                    
                    <!-- Status Bar -->
                    <div class="absolute top-3 w-full px-5 flex justify-between text-[10px] text-white font-medium z-10">
                        <span>9:41</span>
                        <div class="flex space-x-1">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.73 0 1.33-.6 1.33-1.33V5.33C17 4.6 16.4 4 15.67 4z"/></svg>
                        </div>
                    </div>

                    <!-- Notification Area -->
                    <div class="absolute top-14 left-2 right-2 z-20">
                        <!-- Notification Card -->
                        <div id="preview-card" class="bg-white/95 backdrop-blur-md rounded-2xl p-3 shadow-lg transform transition-all duration-300">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <div class="w-5 h-5 bg-blue-600 rounded-md flex items-center justify-center mr-2 shadow-sm">
                                        <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                    </div>
                                    <span class="text-[10px] text-gray-800 font-bold uppercase tracking-wide">APP PROVEDOR</span>
                                </div>
                                <span class="text-[9px] text-gray-500">AGORA</span>
                            </div>
                            <div class="px-0.5">
                                <h4 id="preview-title" class="text-sm font-bold text-gray-900 mb-0.5 leading-tight">Título da notificação</h4>
                                <p id="preview-body" class="text-xs text-gray-600 leading-snug">O conteúdo da sua notificação aparecerá aqui.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="mt-6 flex justify-center space-x-2 bg-gray-900 p-1 rounded-lg border border-gray-700">
                <button type="button" onclick="setPreviewMode('ios')" id="btn-ios" class="px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-gray-700 text-white shadow-sm">iOS</button>
                <button type="button" onclick="setPreviewMode('android')" id="btn-android" class="px-4 py-1.5 rounded-md text-xs font-bold text-gray-400 hover:text-white transition-all">Android</button>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const titleInput = document.querySelector('input[name="title"]');
                const bodyInput = document.querySelector('textarea[name="body"]');
                const previewTitle = document.getElementById('preview-title');
                const previewBody = document.getElementById('preview-body');
                const previewCard = document.getElementById('preview-card');
                const btnIOS = document.getElementById('btn-ios');
                const btnAndroid = document.getElementById('btn-android');
                const segmentButtons = document.querySelectorAll('.segment-btn');
                const segmentInput = document.getElementById('segment-type-input');
                const segmentTagsInput = document.getElementById('segment-tags-input');
                const segmentSearchInput = document.getElementById('segment-search-input');
                const searchButton = document.getElementById('segment-search-btn');

                function updatePreview() {
                    previewTitle.textContent = titleInput.value || 'Título da notificação';
                    previewBody.textContent = bodyInput.value || 'O conteúdo da sua notificação aparecerá aqui.';
                }

                if(titleInput) titleInput.addEventListener('input', updatePreview);
                if(bodyInput) bodyInput.addEventListener('input', updatePreview);

                window.setPreviewMode = function(mode) {
                    if (mode === 'ios') {
                        previewCard.className = 'bg-white/95 backdrop-blur-md rounded-2xl p-3 shadow-lg transform transition-all duration-300';
                        btnIOS.className = 'px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-gray-700 text-white shadow-sm';
                        btnAndroid.className = 'px-4 py-1.5 rounded-md text-xs font-bold text-gray-400 hover:text-white transition-all';
                    } else {
                        previewCard.className = 'bg-white rounded-lg p-3 shadow-md border-l-4 border-blue-500 transform transition-all duration-300 mt-2';
                        btnAndroid.className = 'px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-gray-700 text-white shadow-sm';
                        btnIOS.className = 'px-4 py-1.5 rounded-md text-xs font-bold text-gray-400 hover:text-white transition-all';
                    }
                }

                function resetSegmentStyles() {
                    segmentButtons.forEach(function(button) {
                        button.classList.remove('border-2', 'border-blue-500', 'bg-blue-500/10', 'text-white');
                        button.classList.add('border', 'border-gray-700', 'bg-gray-900', 'text-gray-400');
                    });
                }

                segmentButtons.forEach(function(button) {
                    button.addEventListener('click', function() {
                        const mode = button.getAttribute('data-segment') || 'all';
                        segmentInput.value = mode;
                        resetSegmentStyles();
                        button.classList.remove('border', 'border-gray-700', 'bg-gray-900', 'text-gray-400');
                        button.classList.add('border-2', 'border-blue-500', 'bg-blue-500/10', 'text-white');

                        if (mode === 'tags') {
                            const tags = window.prompt('Informe as tags separadas por vírgula:');
                            if (tags !== null) {
                                segmentTagsInput.value = tags;
                            }
                        }
                    });
                });

                if (searchButton) {
                    searchButton.addEventListener('click', function() {
                        const query = window.prompt('Buscar por nome, e-mail ou CPF:');
                        if (query !== null) {
                            segmentSearchInput.value = query;
                            segmentInput.value = 'search';
                        }
                    });
                }
            });
        </script>

        <!-- Best Practices -->
        <div class="bg-blue-900/20 rounded-2xl p-6 border border-blue-900/30">
            <h3 class="text-sm font-bold text-blue-400 mb-4">Melhores práticas</h3>
            <ul class="space-y-3">
                <li class="flex items-start text-xs text-blue-200/70">
                    <span class="mr-2">•</span>
                    Use títulos curtos e diretos (até 45 caracteres).
                </li>
                <li class="flex items-start text-xs text-blue-200/70">
                    <span class="mr-2">•</span>
                    Combine tags e status para campanhas altamente segmentadas.
                </li>
                <li class="flex items-start text-xs text-blue-200/70">
                    <span class="mr-2">•</span>
                    Utilize agendamentos para evitar horários de baixa abertura.
                </li>
                <li class="flex items-start text-xs text-blue-200/70">
                    <span class="mr-2">•</span>
                    Envie notificações de cobrança com antecedência configurável.
                </li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}
